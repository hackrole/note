<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>hackrole's note - redis_slave</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">hackrole's note </a></h1>
                <nav><ul>
                    <li><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/redisfu-zhi-pei-zhi-xiang-guan.html">redis复制配置相关</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-01-08T14:31:05+08:00">
                Published: 五 08 一月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/hackrole.html">hackrole</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>.</p>
<p>tags: <a href="/tag/redis.html">redis</a> <a href="/tag/redis_slave.html">redis_slave</a> </p>
</footer><!-- /.post-info --><p>原内容来自redis官方文档:</p>
<pre class="literal-block">
redis-replication官方文档&lt;http://redis.io/topics/replication&gt;
</pre>
<p>基本来说，只要在配置文件里加上:</p>
<pre class="literal-block">
slaveof &lt;ip&gt; &lt;port&gt;
</pre>
<p>就可以完成配置.</p>
<p>如下配置可能有用:</p>
<pre class="literal-block">
repl-diskless-sync (不使用磁盘同步)
repl-diskless-sync-delay (同步前的延时, 以等待其他的要链接的slave)
</pre>
<div class="section" id="id1">
<h2>安全问题</h2>
<p>如果redis开启复制特性，同时master节点关闭持久化特性。
这时应该避免master节点的自动重启，避免slave节点上的数据被重启的master节点清空。</p>
</div>
<div class="section" id="id2">
<h2>同步策略</h2>
<p>redis默认使用磁盘同步, 数据被存到RDB file文件, 之后通过同步该文件做full-sync.</p>
<p>但是如果磁盘太慢会导致性能不好，2.8新增直接通过socket来同步的方式.(该方式目前仍然是实验阶段)</p>
</div>
<div class="section" id="id3">
<h2>只读复制</h2>
<p>redis默认slave是只读的,所有写操作会报错.
通过如下方式可以打开读写:</p>
<pre class="literal-block">
slave-read-only no (配置文件)
config set slave-read-only no (redis-cli运行时)
</pre>
<p>即便是只读slave也不应该暴露在公网下.
debug/config等命令仍会带来完全问题(使用rename-command配置)</p>
<p>读写slave在较少场景下会有用。未来redis有可能移除该特性.</p>
</div>
<div class="section" id="id4">
<h2>认证</h2>
<p>redis很快，所以需要设置足够强的密码，不然会很容易被破解。</p>
<p>master节点可以通过配置，要求所有链接需要认证:</p>
<pre class="literal-block">
requirepass &lt;password&gt;
</pre>
<p>这时slave节点需要做如下配置:</p>
<pre class="literal-block">
config set masterauth &lt;password&gt; (运行时)
masterauth &lt;password&gt; (配置文件)
</pre>
</div>
<div class="section" id="id5">
<h2>部分同步</h2>
<!-- TODO: -->
</div>
<div class="section" id="slave">
<h2>控制slave链接数</h2>
<!-- TODO: -->
</div>
                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>